<html><head>
  <title>UFO Sightings</title>
  <head>
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3-scale-radial.js"></script>
  <style type="text/css">

  </style>
  </head>

  <div id="my_dataviz"></div>
    <script id="circularbarplot">
  
  var margin = {top: 100, right: 0, bottom: 0, left: 0},
        width = 975 - margin.left - margin.right,
        height = 975 - margin.top - margin.bottom,
        innerRadius = 210,
        outerRadius = Math.min(width, height) / 2; 

        var svg = d3.select("#my_dataviz")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + (width / 2 + margin.left) + "," + (height / 2 + margin.top) + ")");
      

   
    const requestData = async function() {
     
      const UFO = await d3.csv("./scrubbed.csv", d3.autoType);
      
      
      let dataList = [];
      //gets important data that we care about from data file
      UFO.forEach( (d,i) => {
        
        if ((d.shape === "circle") || (d.shape === "sphere") || (d.shape === "disk") || (d.shape === "fireball")
        || (d.shape === "oval") || (d.shape === "cigar") || (d.shape === "rectangle") || (d.shape === "chevron")
        || (d.shape === "triangle") || (d.shape === "formation") || (d.shape === "egg") || (d.shape === "changing")
        || (d.shape === "diamond") || (d.shape === "flash") || (d.shape === "teardrop") || (d.shape === "cone")
        ||(d.shape === "cross") || (d.shape === "cylinder") || (d.shape === "light")) {
        var temp = {
          "Shape": d.shape,
          "Country": d.country,
          "Year": d.datetime.split(" ")[0].split("/")[2],
          "Month": d.datetime.split(" ")[0].split("/")[0],
          "Day": d.datetime.split(" ")[0].split("/")[1],
          "Comments": d.comments
        };
        dataList.push(temp);
        }; 
      });

      var TotalSightings = getShapeFrequency(dataList);
      var groups = getShapes(TotalSightings);
      var subgroups = ["1950", "1960", "1970", "1980", "1990", "2000", "2010", "2020"];
      var data = shapesArray(dataList);
      var stackedData = d3.stack()
                          .keys(subgroups)(data);
      
      console.log(groups);
        var x = d3.scaleBand()
                  .range([0, 2 * Math.PI])    
                  .domain(groups); 
        var y = d3.scaleRadial()
            .range([innerRadius, outerRadius])   
            .domain([0, 20000]);

        var z = d3.scaleOrdinal()
                    .domain(subgroups)
                    .range(d3.schemeCategory20);
        const colorScale=d3.scaleOrdinal(["#d54b04","#dc5107","#e3570a","#e85e0e","#ed6614","#f16d1a","#f57623","#f87f2c","#fa8736","#fb8e3f","#fc974a",
        "#fd9e55","#fda55f","#fdad6a","#fdb577","#fdbc83","#fdc490","#fdcb9b","#fdd2a7"]);
        var arc = d3.arc()
                    .innerRadius(innerRadius)
                    .outerRadius(function(d) { return y(d[1]);})
                    .startAngle(function(d) { return x(d[0]);})
                    .endAngle(function(d) { return x(d[0]) + x.bandwidth(); })
                    .padAngle(0.01)
                    .padRadius(innerRadius);
        // svg.append("g")
        //    .selectAll("g")
        //    .data(stackedData)
        //    .join("g")
        //    .attr("fill", d => z(d.key))
        //    .selectAll("path")
        //    .data(d => Number(d))
        //    .join("path")
          //  .attr("d", arc);
        // svg.append("g")
        //    .selectAll("g")
        //    .data(stackedData)
        //    .enter()
        //    .append("g")
        //    .selectAll("rect")
        //    .data(d =>d)
        //    .enter().append("rect")
        //    .attr("d", arc);

svg.append("g")
    .selectAll("path")
    .data(TotalSightings)
    .enter()
    .append("path")
    .attr("fill", d=>colorScale(d))
    .attr("d", d3.arc()     
    .innerRadius(innerRadius)
    .outerRadius(function(d) { return y(d[1]); })
    .startAngle(function(d) { return x(d[0]);})
    .endAngle(function(d) { return x(d[0]) + x.bandwidth(); })
    .padAngle(0.01)
    .padRadius(innerRadius));


  svg.append("g")
     .selectAll("g")
     .data(TotalSightings)
     .enter()
     .append("g")
     .attr("text-anchor", function(d) { return (x(d[0]) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? "end" : "start"; })
     .attr("transform", function(d) { return "rotate(" + ((x(d[0]) + x.bandwidth() / 2) * 180 / Math.PI - 90) + ")"+"translate(" + (y(d[1])+10) + ",0)"; })
     .append("text")
     .text(function(d){return(d[1])})
     .attr("transform", function(d) { return (x(d[0]) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? "rotate(180)" : "rotate(0)"; })
     .style("font-size", "11px")
     .attr("alignment-baseline", "middle");

     xAxis = g => g
    .attr("text-anchor", "middle")
    .call(g => g.selectAll("g")
      .data(TotalSightings)
      .join("g")
        .attr("transform", d => `
          rotate(${((x(d[0]) + x.bandwidth() / 2) * 180 / Math.PI - 90)})
          translate(${innerRadius},0)
        `)
        .call(g => g.append("line")
            .attr("x2", -5)
            .attr("stroke", "#000"))
        .call(g => g.append("text")
            .attr("transform", d => (x(d[0]) + x.bandwidth() / 2 + Math.PI / 2) % (2 * Math.PI) < Math.PI
                ? "rotate(90)translate(0,16)"
                : "rotate(-90)translate(0,-9)")
            .text(d => d[0])));
            svg.append("g")
      .call(xAxis);
//   var select = d3.select("#country")
// 		             .on("change", function() {
// 			update(this.value, 750)
// 		})

//      function update(input, speed) {
//      var data = csv.filter(f => f.country == input)
//      console.log(data);
// }

      function getShapes(UFOdata){
      let shapes = []; 
      for (var i = 0; i<UFOdata.length; i++){
        var shape = UFOdata[i][0];
        if (shape !== null) {
          //console.log("in here"); 
          if (!(shapes.includes(shape))) {
            shapes.push(shape);
            //console.log("inside here"); 

          }; 
        };
      };
      return shapes; 
    }

    //console.log("hi"); 
    //console.log(getShapes(dataList));

    function getShapeFrequency(UFOdata){
        let shapeFreq = {}; 
        var sortable =[];
        for (var i = 0; i<UFOdata.length; i++){
          var shape = UFOdata[i]["Shape"];
          if (shape in shapeFreq) {
            shapeFreq[shape] +=1;
          } else {
            shapeFreq[shape] = 1;
          }
        };
        for( var shape in shapeFreq){
          sortable.push([shape, shapeFreq[shape]]);
        }
        sortable.sort(function(a,b){
          return b[1] - a[1];
        })
        return sortable;
      }
  
    
    function getShapeYears(UFOdata){
        let shapeYears = []; 
        for (var i = 0; i<UFOdata.length; i++){
          var year = UFOdata[i]["Year"];
          if (!(year in shapeYears)) {
            shapeYears.push(year);
        };
        return shapeYears; 
        }
    }

    

    
    //NEED TO FIND OUT NUMBER OF EACH SHAPE PER YEAR?? (PER DECADE IDEALLY)
    //{"circle: {"1940": 100, "1950": 200, ...}, square: {1940": 100, "1950": 600, ...}, ...}
    //[{"Shape": "circle", "1940": 100, "1950": 200, ...}, {"Shape": "square", "1940": 200, "1950": 600, ...}]
    function getShapesPerYear(UFOdata){
        let shapesPerYear = []; 
        for (var i = 0; i<UFOdata.length; i++){
          var year = UFOdata[i]["Year"];
          var shape = UFOdata[i]["Shape"];
          if (year in shapesPerYear) { 
            if (shape in shapesPerYear[year])
                shapesPerYear[year][shape] += 1; 
            else{
              shapesPerYear[year][shape] = 1; 
            } 
          } else {
            shapesPerYear[year] = {}; //NEED HELP WITH THIS LINE
          };
        return shapesPerYear; 
        }
    }

    function shapesArray(UFOdata) {
      var shapearray = getShapes(UFOdata);
      var finalData = []; 
      for (var i = 0; i<shapearray.length; i++) {
        var temp = totalShapeDict(shapearray[i], UFOdata);
        finalData.push(temp); 
      };
      return finalData;
    }

    // console.log(shapesArray(dataList)); 
    //decade = 1940 or 1950, ... 
    //shape = "circle" ...
    //will return {"Shape": "circle", 1}
    function totalShapeDict(shape, UFOdata) {
        var shapeDict = {'0Shape': shape, '1910':0, '1920': 0, '1930': 0, '1940': 0,'1950': 0, '1960': 0, '1970': 0, '1980': 0, '1990': 0, '2000': 0, '2010': 0, '2020': 0}; 
        for (var i = 0; i<UFOdata.length; i++){
          var dataShape = UFOdata[i]["Shape"]; 
          if (dataShape === shape){
            var year = UFOdata[i]["Year"];
            var dec = year.charAt(2); 
            if ((dec === "2") || (dec === "3") || (dec === "4") || (dec === "5") || (dec === "6") || (dec === "7") || (dec === "8") || (dec === "9")) {
              var decade = ("19").concat(dec, "0"); 
              shapeDict[decade] += 1; 
            } else if (dec === "1") {
              if (year.charAt(0) === "1") {
                var decade = ("19").concat(dec, "0"); 
                shapeDict[decade] += 1;
              } else {
                var decade = ("20").concat(dec, "0"); 
                shapeDict[decade] += 1;
              };
            }
            else {
              var decade2000= ("20").concat(dec, "0"); 
              shapeDict[decade2000] += 1; 
            };
          }; 
        };
        shapeDict["0Shape"] = shape; 
        return shapeDict; 
      }

    console.log(totalShapeDict("hexagon", dataList)); 

    //decade = 1940 or 1950, ... 
    //shape = "circle" ...
    //will return number for that shape for that decade
    function shapePerDecade(decade, shape, UFOdata) {
      var totalNum = 0;
      var count = 0; 
      for (var i = 0; i<UFOdata.length; i++){
        count += 1; 
        var year = UFOdata[i]["Year"];
        var dataShape = UFOdata[i]["Shape"];
        if ((dataShape === shape) && (year - decade < 10)) {
          totalNum += 1; 
        }; 
      
      };
      return totalNum; 
    }


      function getShapeFrequencyByCountry(UFOdata, country) {
        let shapeFreq = {};
        for (var i = 0; i<UFOdata.length; i++){
          var nation = UFOdata[i]["Country"];
          if (nation == country){
            var shape = UFOdata[i]["Shape"];
            if (shape in shapeFreq) {
              shapeFreq[shape] += 1;
            } else {
              shapeFreq[shape] = 1;
            }
          } 
        };
        return shapeFreq;
      }


      
     }
    requestData();
    
    
    
  
  
  
  
    </script>
  
  
  
  
  
    
  
    </div>
  </body>
  </html>


    