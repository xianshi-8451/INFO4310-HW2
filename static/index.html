<html><head>
  <title>UFO Sightings</title>
  <head>
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3-scale-radial.js"></script>
  </head>
  <div id="my_dataviz"></div>
  <h2 id="btn">Button</h2>
  
    <script id="circularbarplot">
  
  var margin = {top: 100, right: 0, bottom: 0, left: 0},
        width = 975 - margin.left - margin.right,
        height = 975 - margin.top - margin.bottom,
        innerRadius = 180,
        outerRadius = Math.min(width, height) / 2; 

        var svg = d3.select("#my_dataviz")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + (width / 2 + margin.left) + "," + (height / 2 + margin.top) + ")");
      
    
   
    const requestData = async function() {
     
      const UFO = await d3.csv("./scrubbed.csv", d3.autoType);
      
      
      let allData = [];
      //gets important data that we care about from data file
      UFO.forEach( (d,i) => {
        
        if ((d.shape === "circle") || (d.shape === "sphere") || (d.shape === "disk") || (d.shape === "fireball")
        || (d.shape === "oval") || (d.shape === "cigar") || (d.shape === "rectangle") || (d.shape === "chevron")
        || (d.shape === "triangle") || (d.shape === "formation") || (d.shape === "egg") || (d.shape === "changing")
        || (d.shape === "diamond") || (d.shape === "flash") || (d.shape === "teardrop") || (d.shape === "cone")
        ||(d.shape === "cross") || (d.shape === "cylinder") || (d.shape === "light")) {
        var temp = {
          "Shape": d.shape,
          "Country": d.country,
          "Year": d.datetime.split(" ")[0].split("/")[2],
          "Month": d.datetime.split(" ")[0].split("/")[0],
          "Day": d.datetime.split(" ")[0].split("/")[1],
          "Comments": d.comments
        };
        allData.push(temp);
        }; 
        
      

        

      });
      //start update function
      function update(dataList){

      
      //update(dataList)
      var TotalSightings = getShapeFrequency(dataList);
      var groups = getShapes(dataList);
      var subgroups = ["1950", "1960", "1970", "1980", "1990", "2000", "2010", "2020"];
      var data = shapesArray(dataList);
      var stackedData = d3.stack()
                          .keys(subgroups)
                          (data)
      
      for (let i = 0; i< stackedData.length; i++){
        let index = stackedData[i]["index"];
        let key = stackedData[i]["key"]; 
        stackedData[i] = stackedData[i].filter(e=>{
          return (e[0] !== e[1]);
        });
        stackedData[i]["key"] = key; 
        stackedData[i]["index"] = index;

      };
      
      console.log(stackedData); 
      console.log(groups);
        var x = d3.scaleBand()
                  .range([0, 2 * Math.PI])    
                  .domain(groups); 
        var y = d3.scaleRadial()
            .range([innerRadius, outerRadius])   
            .domain([0, 14000]);

        var z = d3.scaleOrdinal()
                    .domain(subgroups)
                    .range(d3.schemeCategory10);
                    //.range(["steelblue", "darkorange", "lightblue", "steelblue", "darkorange", "lightblue","darkorange", "lightblue"]);
        // var arc = d3.arc()
        //             .innerRadius(innerRadius)
        //             .outerRadius(function(d) { return y(d[1]);})
        //             .startAngle(function(d) { return x(d[0]);})
        //             .endAngle(function(d) { return x(d[0]) + x.bandwidth(); })
        //             .padAngle(0.01)
        //             .padRadius(innerRadius);

        // var color = d3.scaleOrdinal()
        //   .domain(subgroups)
        //   .range(['#e41a1c','#377eb8','#4daf4a', '#e41a1c','#377eb8','#4daf4a','#377eb8','#4daf4a']); 
        // svg.append("g")
        //    .selectAll("g")
        //    .data(stackedData)
        //    .join("g")
        //    .attr("fill", d => z(d.key))
        //    .selectAll("path")
        //    .data(d => Number(d))
        //    .join("path")
          //  .attr("d", arc);

          let arcGen = d3.arc()
            .innerRadius(function(d) { return y(d[0]); })
            .outerRadius(function(d) { return y(d[1]); })
            .startAngle(function(d) { return x(d["data"]["0Shape"]);}) //name of shape
            .endAngle(function(d) { return x(d["data"]["0Shape"]) + x.bandwidth(); })
            .padAngle(0.01)
            .padRadius(innerRadius)

          // svg.append("g")
          //   .selectAll("path")
          //   .data(TotalSightings)
          //   .enter()
          //   .append("path")
          //   .attr("fill", d=>colorScale(d))
          //   .attr("d", );
        

        // stackedData.forEach(d=>{
        //   let gTag = svg.append("g");
        //   console.log(d); 
        //   d.forEach(e => {
            
        //     let path = gTag.append("path"); 
        //     path.attr("d", arcGen(e))
        //     .attr("fill", z(d.key));

        //   })

        // })

        
        svg.selectAll("g.BarSegment")
           .data(stackedData)
           .join("g")
           .attr("class", "BarSegment")
           .attr("fill", d=> z(d.key))
           .selectAll("path")
           .data(d =>d)
           .join("path")
           .transition().duration(5000)
           .attr("d", arcGen); 
           

// svg.append("g")
//     .selectAll("path")
//     .data(Object.entries(TotalSightings))
//     .enter()
//     .append("path")
//     .attr("fill", "#69b3a2")
//     .attr("d", d3.arc()     
//     .innerRadius(innerRadius)
//     .outerRadius(function(d) { return y(d[1]); })
//     .startAngle(function(d) { return x(d[0]);})
//     .endAngle(function(d) { return x(d[0]) + x.bandwidth(); })
//     .padAngle(0.01)
//     .padRadius(innerRadius));

  let shapes = [];
  stackedData.forEach(d=> {
    console.log(d);
    if (d.length > 0){
    shapes.push(d[0]["data"]["0Shape"]); 
    };
  });

  // 
  // svg.selectAll("g.Label")
  //    .data(shapes)
  //    .join("g")
        //.attr("class","Label")
  //    .attr("text-anchor", function(d) { return (x(d[0]) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? "end" : "start"; })
  //    .attr("transform", function(d) { return "rotate(" + ((x(d[0]) + x.bandwidth() / 2) * 180 / Math.PI - 90) + ")"+"translate(" + (y(d[1])+10) + ",0)"; })
  //    .data(d=>d)
  //    .join("text")
  //    .text(function(d){return(d[0])})
  //    .attr("transform", function(d) { return (x(d[0]) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? "rotate(180)" : "rotate(0)"; })
  //    .style("font-size", "11px")
  //    .attr("alignment-baseline", "middle")

      }

    update(allData); 
    d3.select("#btn").on("click", event=>{
      let filterDataset = allData.filter(d=>{
        return (d.Country === "us"); 
      })
      update(filterDataset); 
    })

var data = shapesArray(allData);
console.log(data);
      function getShapes(UFOdata){
      let shapes = []; 
      for (var i = 0; i<UFOdata.length; i++){
        var shape = UFOdata[i]["Shape"];
        if (shape !== null) {
          //console.log("in here"); 
          if (!(shapes.includes(shape))) {
            shapes.push(shape);
            //console.log("inside here"); 

          }; 
        };
      };
      return shapes; 
    }

    //console.log("hi"); 
    //console.log(getShapes(dataList));

    function getShapeFrequency(UFOdata){
        let shapeFreq = {}; 
        for (var i = 0; i<UFOdata.length; i++){
          var shape = UFOdata[i]["Shape"];
          if (shape in shapeFreq) {
            shapeFreq[shape] +=1;
          } else {
            shapeFreq[shape] = 1;
          }
        };
        return shapeFreq; 
      }
    
    function getShapeYears(UFOdata){
        let shapeYears = []; 
        for (var i = 0; i<UFOdata.length; i++){
          var year = UFOdata[i]["Year"];
          if (!(year in shapeYears)) {
            shapeYears.push(year);
        };
        return shapeYears; 
        }
    }

    

    
    //NEED TO FIND OUT NUMBER OF EACH SHAPE PER YEAR?? (PER DECADE IDEALLY)
    //{"circle: {"1940": 100, "1950": 200, ...}, square: {1940": 100, "1950": 600, ...}, ...}
    //[{"Shape": "circle", "1940": 100, "1950": 200, ...}, {"Shape": "square", "1940": 200, "1950": 600, ...}]
    function getShapesPerYear(UFOdata){
        let shapesPerYear = []; 
        for (var i = 0; i<UFOdata.length; i++){
          var year = UFOdata[i]["Year"];
          var shape = UFOdata[i]["Shape"];
          if (year in shapesPerYear) { 
            if (shape in shapesPerYear[year])
                shapesPerYear[year][shape] += 1; 
            else{
              shapesPerYear[year][shape] = 1; 
            } 
          } else {
            shapesPerYear[year] = {}; //NEED HELP WITH THIS LINE
          };
        return shapesPerYear; 
        }
    }

    function shapesArray(UFOdata) {
      var shapearray = getShapes(UFOdata);
      console.log(shapearray); 
      var finalData = []; 
      for (var i = 0; i<shapearray.length; i++) {
        var temp = totalShapeDict(shapearray[i], UFOdata);
        finalData.push(temp); 
        console.log("in here"); 
      };
      return finalData;
    }

    console.log(shapesArray(dataList)); 
    //decade = 1940 or 1950, ... 
    //shape = "circle" ...
    //will return {"Shape": "circle", 1}
    function totalShapeDict(shape, UFOdata) {
        var shapeDict = {'0Shape': shape, '1910':0, '1920': 0, '1930': 0, '1940': 0,'1950': 0, '1960': 0, '1970': 0, '1980': 0, '1990': 0, '2000': 0, '2010': 0, '2020': 0}; 
        for (var i = 0; i<UFOdata.length; i++){
          var dataShape = UFOdata[i]["Shape"]; 
          if (dataShape === shape){
            var year = UFOdata[i]["Year"];
            var dec = year.charAt(2); 
            if ((dec === "2") || (dec === "3") || (dec === "4") || (dec === "5") || (dec === "6") || (dec === "7") || (dec === "8") || (dec === "9")) {
              var decade = ("19").concat(dec, "0"); 
              shapeDict[decade] += 1; 
            } else if (dec === "1") {
              if (year.charAt(0) === "1") {
                var decade = ("19").concat(dec, "0"); 
                shapeDict[decade] += 1;
              } else {
                var decade = ("20").concat(dec, "0"); 
                shapeDict[decade] += 1;
              };
            }
            else {
              var decade2000= ("20").concat(dec, "0"); 
              shapeDict[decade2000] += 1; 
            };
          }; 
        };
        shapeDict["0Shape"] = shape; 
        return shapeDict; 
      }

    console.log(totalShapeDict("hexagon", dataList)); 

    //decade = 1940 or 1950, ... 
    //shape = "circle" ...
    //will return number for that shape for that decade
    function shapePerDecade(decade, shape, UFOdata) {
      var totalNum = 0;
      var count = 0; 
      for (var i = 0; i<UFOdata.length; i++){
        count += 1; 
        var year = UFOdata[i]["Year"];
        var dataShape = UFOdata[i]["Shape"];
        if ((dataShape === shape) && (year - decade < 10)) {
          totalNum += 1; 
        }; 
      
      };
      return totalNum; 
    }
      //gets number of sightings per shape (~29 or 30) 
      function getShapeFrequency(UFOdata){
        let shapeFreq = {}; 
        for (var i = 0; i<UFOdata.length; i++){
          var shape = UFOdata[i]["Shape"];
          if (shape in shapeFreq) {
            shapeFreq[shape] +=1;
          } else {
            shapeFreq[shape] = 1;
          }
        };
        return shapeFreq; 
      }
      //console.log(getShapeFrequency(dataList)); 

      function getShapeFrequencyByCountry(UFOdata, country) {
        let shapeFreq = {};
        for (var i = 0; i<UFOdata.length; i++){
          var nation = UFOdata[i]["Country"];
          if (nation == country){
            var shape = UFOdata[i]["Shape"];
            if (shape in shapeFreq) {
              shapeFreq[shape] += 1;
            } else {
              shapeFreq[shape] = 1;
            }
          } 
        };
        return shapeFreq;
      }


      
     }
    requestData();
    
    
    
  
  
  
  
    </script>
  
  
  
  
  
    
  
    </div>
  </body>
  </html>


    